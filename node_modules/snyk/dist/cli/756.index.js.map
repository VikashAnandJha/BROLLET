{"version":3,"file":"756.index.js","mappings":";;;;;;;;AAAa;AACb,aAAa,mBAAO,CAAC,KAAM;AAC3B,WAAW,mBAAO,CAAC,KAAI;;AAEvB;AACA;AACA,OAAO,KAAK;;AAEZ;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,8CAA8C,YAAY;AAC1D;;AAEA,0BAA0B,iBAAiB;;AAE3C;AACA;AACA,cAAc,eAAe;AAC7B;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA,sBAAsB;;;;;;;;;;ACxEtB,0DAA4D;AAC5D,2CAA0D;AAC1D,6DAAwG;AACxG,wDAAkF;AAClF,4CAAsC;AAEtC,MAAM,WAAW,GAAG,mBAAO,CAAC,KAAgC,CAAC,CAAC;AAE/C,KAAK,UAAU,KAAK,CAAC,GAAG,IAAgB;;IACrD,MAAM,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,yCAAkB,CAAC,GAAG,IAAI,CAAC,CAAC;IAEvD,IAAI,OAAO,CAAC,GAAG,IAAI,IAAI,EAAE;QACvB,OAAO,WAAW,CAAC,OAAO,CAAC,CAAC;KAC7B;IAED,MAAM,WAAW,SAAG,OAAO,CAAC,GAAG,mCAAI,gBAAM,CAAC,GAAG,CAAC;IAC9C,MAAM,cAAc,GAAG,MAAM,sCAAiB,CAAC,WAAW,CAAC,CAAC;IAE5D,IAAI,QAAC,cAAc,CAAC,YAAY,0CAAE,QAAQ,GAAE;QAC1C,MAAM,IAAI,4DAAkC,CAAC,OAAO,EAAE,UAAU,CAAC,CAAC;KACnE;IAED,IAAI;QACF,MAAM,IAAI,GAAG,iBAAS,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;QACvC,MAAM,GAAG,GAAG,MAAM,gBAAQ,CAAC,IAAI,CAAC,CAAC;QACjC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;KACnB;IAAC,OAAO,CAAC,EAAE;QACV,MAAM,GAAG,GAAG,IAAI,KAAK,CAAC,4BAA4B,GAAG,CAAC,CAAC,CAAC;QACxD,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;KAC5B;AACH,CAAC;AAtBD,wBAsBC;;;;;;;;;;;AC7BD,SAAgB,kBAAkB,CAChC,GAAG,IAAI;IAEP,IAAI,OAAO,GAAI,EAAsC,CAAC;IAEtD,IAAI,OAAO,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,QAAQ,EAAE;QAC7C,OAAO,GAAI,IAAI,CAAC,GAAG,EAAsC,CAAC;KAC3D;IACD,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;IAE5B,6EAA6E;IAC7E,IAAI,IAAI,CAAC,MAAM,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE;QACxC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,EAAE,CAAC,CAAC;KAC7B;IAED,OAAO,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAE,CAAC;AAClC,CAAC;AAhBD,gDAgBC;;;;;;;;;;;ACPD,IAAY,cAOX;AAPD,WAAY,cAAc;IACxB,mCAAiB;IACjB,+CAA6B;IAC7B,yDAAuC;IACvC,mCAAiB;IACjB,yCAAuB;IACvB,8CAA4B;AAC9B,CAAC,EAPW,cAAc,GAAd,sBAAc,KAAd,sBAAc,QAOzB;AAEY,mCAA2B,GAAsB;IAC5D,cAAc,CAAC,GAAG;IAClB,cAAc,CAAC,SAAS;IACxB,cAAc,CAAC,cAAc;IAC7B,cAAc,CAAC,GAAG;IAClB,cAAc,CAAC,SAAS;IACxB,cAAc,CAAC,MAAM;CACtB,CAAC;AAEW,6BAAqB,GAAG;IACnC,IAAI,EAAE,cAAc,CAAC,GAAG;IACxB,GAAG,EAAE,cAAc,CAAC,GAAG;IACvB,IAAI,EAAE,cAAc,CAAC,GAAG;IACxB,EAAE,EAAE,cAAc,CAAC,SAAS;CAC7B,CAAC;;;;;;;;;;;;AClCF,4CAAkC;AAClC,iDAA+C;AAC/C,sCAAyB;AACzB,+CAAiC;AACjC,sCAAyB;AACzB,6CAAqC;AACrC,6CAAyC;AACzC,4CAAsC;AACtC,wCAA6B;AAC7B,0CAAiC;AAEjC,MAAM,SAAS,SAAG,gBAAM,CAAC,UAAU,mCAAI,mBAAQ,CAAC,MAAM,CAAC,CAAC,KAAK,CAAC;AAC9D,MAAM,KAAK,GAAG,QAAQ,CAAC,OAAO,CAAC,CAAC;AAEnB,uBAAe,GAAG,SAAS,CAAC;AACzC,MAAM,iBAAiB,GAAG;IACxB,0BAA0B,EACxB,kEAAkE;IACpE,qBAAqB,EACnB,kEAAkE;IACpE,kBAAkB,EAChB,kEAAkE;IACpE,oBAAoB,EAClB,kEAAkE;IACpE,oBAAoB,EAClB,kEAAkE;IACpE,4BAA4B,EAC1B,kEAAkE;IACpE,qBAAqB,EACnB,kEAAkE;IACpE,0BAA0B,EACxB,kEAAkE;IACpE,kBAAkB,EAChB,kEAAkE;IACpE,4BAA4B,EAC1B,kEAAkE;CACrE,CAAC;AAEF,MAAM,WAAW,GAAG,qDAAqD,CAAC;AAC1E,MAAM,YAAY,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,GAAG,uBAAe,CAAC,CAAC;AAmBzE,SAAgB,SAAS,CACvB,QAAkB,EAClB,OAAwB;IAExB,MAAM,IAAI,GAAa,QAAQ,CAAC;IAEhC,IAAI,OAAO,CAAC,KAAK,EAAE;QACjB,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;KACtB;IAED,IAAI,OAAO,CAAC,MAAM,EAAE;QAClB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;KAC3B;IAED,IAAI,OAAO,CAAC,MAAM,EAAE;QAClB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QACtB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC;KAC3B;IAED,IAAI,OAAO,CAAC,OAAO,EAAE;QACnB,IAAI,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;QACvB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;KAC5B;IAED,IAAI,OAAO,CAAC,WAAW,CAAC,EAAE;QACxB,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACzB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC,CAAC;KACjC;IAED,IAAI,OAAO,CAAC,cAAc,CAAC,EAAE;QAC3B,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC5B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,CAAC,CAAC,CAAC;KACpC;IAED,IAAI,OAAO,CAAC,qBAAqB,CAAC,EAAE;QAClC,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QACnC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,qBAAqB,CAAC,CAAC,CAAC;KAC3C;IAED,IAAI,OAAO,CAAC,MAAM,EAAE;QAClB,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;KACvB;IAED,IAAI,OAAO,CAAC,IAAI,EAAE;QAChB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;KACrB;IAED,IAAI,OAAO,CAAC,WAAW,EAAE;QACvB,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC3B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAC;KAChC;IAED,IAAI,OAAO,CAAC,aAAa,CAAC,EAAE;QAC1B,IAAI,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;QAC3B,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,CAAC,CAAC;KACnC;IAED,IAAI,SAAS,GAAG,SAAS,CAAC;IAC1B,iBAAiB,CAAC,SAAS,CAAC,CAAC;IAC7B,IAAI,OAAO,CAAC,YAAY,CAAC,EAAE;QACzB,SAAS,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;KACnC;IACD,IAAI,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;IAC1B,IAAI,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;IAErB,IAAI,OAAO,CAAC,IAAI,EAAE;QAChB,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACpB,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;KACzB;IAED,IAAI,EAAE,GAAG,QAAQ,CAAC;IAClB,IAAI,OAAO,CAAC,EAAE,EAAE;QACd,EAAE,GAAG,OAAO,CAAC,EAAE,CAAC;KACjB;IACD,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAClB,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;IAEd,KAAK,CAAC,IAAI,CAAC,CAAC;IAEZ,OAAO,IAAI,CAAC;AACd,CAAC;AAjFD,8BAiFC;AAEM,KAAK,UAAU,QAAQ,CAAC,IAAc;IAC3C,KAAK,CAAC,sBAAsB,EAAE,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;IAE9C,MAAM,IAAI,GAAG,MAAM,cAAc,EAAE,CAAC;IAEpC,OAAO,MAAM,MAAM,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAClC,CAAC;AAND,4BAMC;AAED,KAAK,UAAU,MAAM,CAAC,IAAY,EAAE,IAAc;IAChD,OAAO,IAAI,OAAO,CAAS,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QAC7C,MAAM,KAAK,GAAG,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,EAAE,EAAE,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC;QAEpE,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE,CAAC,KAAK,EAAE,EAAE;YAC1B,MAAM,CAAC,KAAK,CAAC,CAAC;QAChB,CAAC,CAAC,CAAC;QAEH,KAAK,CAAC,EAAE,CAAC,MAAM,EAAE,CAAC,IAAI,EAAE,EAAE;YACxB,IAAI,IAAI,IAAI,IAAI,EAAE;gBAChB,yCAAyC;gBACzC,MAAM,CAAC,IAAI,KAAK,CAAC,wBAAwB,CAAC,CAAC,CAAC;aAC7C;iBAAM;gBACL,OAAO,CAAC,IAAI,CAAC,CAAC;aACf;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC;AAED,KAAK,UAAU,cAAc;IAC3B,IAAI,IAAI,GAAG,MAAM,YAAY,EAAE,CAAC;IAChC,IAAI,IAAI,KAAK,EAAE,EAAE;QACf,IAAI;YACF,iBAAiB,CAAC,SAAS,CAAC,CAAC;YAC7B,IAAI,GAAG,YAAY,CAAC;YACpB,MAAM,QAAQ,CAAC,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC;SACrC;QAAC,OAAO,GAAG,EAAE;YACZ,OAAO,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;SAC5B;KACF;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAEM,KAAK,UAAU,YAAY;IAChC,2DAA2D;IAC3D,IAAI,QAAQ,GAAG,gBAAM,CAAC,aAAa,CAAC;IACpC,IAAI,QAAQ,IAAI,IAAI,EAAE;QACpB,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,QAAQ,CAAC,CAAC;QACrC,IAAI,MAAM,EAAE;YACV,KAAK,CAAC,sCAAsC,EAAE,QAAQ,CAAC,CAAC;YACxD,OAAO,QAAQ,CAAC;SACjB;KACF;IAED,sBAAsB;IACtB,QAAQ,GAAG,YAAY,CAAC;IACxB,MAAM,MAAM,GAAG,MAAM,KAAK,CAAC,QAAQ,CAAC,CAAC;IACrC,IAAI,MAAM,EAAE;QACV,KAAK,CAAC,6BAA6B,EAAE,QAAQ,CAAC,CAAC;QAC/C,OAAO,QAAQ,CAAC;KACjB;IACD,KAAK,CAAC,oBAAoB,CAAC,CAAC;IAE5B,OAAO,EAAE,CAAC;AACZ,CAAC;AArBD,oCAqBC;AAED,KAAK,UAAU,QAAQ,CAAC,GAAG,EAAE,WAAmB;IAC9C,KAAK,CAAC,8BAA8B,EAAE,WAAW,CAAC,CAAC;IAEnD,MAAM,OAAO,GAAG;QACd,MAAM,EAAE,KAAK;QACb,GAAG,EAAE,GAAG;QACR,MAAM,EAAE,WAAW;QACnB,MAAM,EAAE,CAAC;KACV,CAAC;IAEF,MAAM,iBAAO,CAAC,gBAAgB,CAAC,CAAC;IAChC,OAAO,IAAI,OAAO,CAAU,CAAC,OAAO,EAAE,MAAM,EAAE,EAAE;QAC9C,qBAAW,CAAC,OAAO,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI;YAC1C,IAAI;gBACF,IAAI,GAAG,EAAE;oBACP,MAAM,CACJ,IAAI,KAAK,CAAC,mCAAmC,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,CAAC,CAClE,CAAC;oBACF,OAAO;iBACR;gBACD,IAAI,GAAG,CAAC,UAAU,KAAK,GAAG,EAAE;oBAC1B,MAAM,CACJ,IAAI,KAAK,CACP,mCAAmC,GAAG,GAAG,GAAG,IAAI,GAAG,GAAG,CAAC,UAAU,CAClE,CACF,CAAC;oBACF,OAAO;iBACR;gBAED,gBAAgB,CAAC,IAAI,CAAC,CAAC;gBAEvB,EAAE,CAAC,aAAa,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;gBACpC,KAAK,CAAC,cAAc,GAAG,WAAW,CAAC,CAAC;gBAEpC,EAAE,CAAC,SAAS,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;gBACjC,OAAO,CAAC,IAAI,CAAC,CAAC;aACf;oBAAS;gBACR,iBAAO,CAAC,QAAQ,EAAE,CAAC;aACpB;QACH,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,gBAAgB,CAAC,IAAY;IACpC,8DAA8D;IAC9D,IAAI,gBAAM,CAAC,YAAY,IAAI,gBAAM,CAAC,aAAa,EAAE;QAC/C,OAAO;KACR;IAED,MAAM,YAAY,GAAG,MAAM;SACxB,UAAU,CAAC,QAAQ,CAAC;SACpB,MAAM,CAAC,IAAI,CAAC;SACZ,MAAM,CAAC,KAAK,CAAC,CAAC;IACjB,MAAM,SAAS,GAAG,iBAAiB,CAAC,gBAAgB,EAAE,CAAC,CAAC;IAExD,IAAI,YAAY,IAAI,SAAS,EAAE;QAC7B,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;KACjE;AACH,CAAC;AACD,SAAS,gBAAgB;IACvB,IAAI,QAAQ,GAAG,OAAO,CAAC;IACvB,QAAQ,EAAE,CAAC,QAAQ,EAAE,EAAE;QACrB,KAAK,QAAQ;YACX,QAAQ,GAAG,QAAQ,CAAC;YACpB,MAAM;QACR,KAAK,OAAO;YACV,QAAQ,GAAG,SAAS,CAAC;YACrB,MAAM;KACT;IAED,IAAI,IAAI,GAAG,OAAO,CAAC;IACnB,QAAQ,EAAE,CAAC,IAAI,EAAE,EAAE;QACjB,KAAK,MAAM,CAAC;QACZ,KAAK,KAAK;YACR,IAAI,GAAG,KAAK,CAAC;YACb,MAAM;QACR,KAAK,KAAK;YACR,IAAI,GAAG,KAAK,CAAC;YACb,MAAM;QACR,KAAK,OAAO;YACV,IAAI,GAAG,OAAO,CAAC;YACf,MAAM;KACT;IAED,IAAI,GAAG,GAAG,EAAE,CAAC;IACb,QAAQ,EAAE,CAAC,QAAQ,EAAE,EAAE;QACrB,KAAK,OAAO;YACV,GAAG,GAAG,MAAM,CAAC;YACb,MAAM;KACT;IAED,OAAO,YAAY,QAAQ,IAAI,IAAI,GAAG,GAAG,EAAE,CAAC;AAC9C,CAAC;AAED,SAAS,WAAW;IAClB,IAAI,gBAAM,CAAC,YAAY,EAAE;QACvB,OAAO,gBAAM,CAAC,YAAY,CAAC;KAC5B;IAED,OAAO,GAAG,WAAW,IAAI,uBAAe,IAAI,gBAAgB,EAAE,EAAE,CAAC;AACnE,CAAC;AAED,SAAS,KAAK,CAAC,QAAgB;IAC7B,OAAO,IAAI,OAAO,CAAU,CAAC,OAAO,EAAE,EAAE;QACtC,EAAE,CAAC,MAAM,CAAC,QAAQ,EAAE,EAAE,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,GAAG,EAAE,EAAE;YAC7C,IAAI,GAAG,EAAE;gBACP,OAAO,CAAC,KAAK,CAAC,CAAC;gBACf,OAAO;aACR;YACD,OAAO,CAAC,IAAI,CAAC,CAAC;QAChB,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC;AAED,SAAS,iBAAiB,CAAC,IAAY;IACrC,IAAI,CAAC,EAAE,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE;QACxB,EAAE,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;KACzC;AACH,CAAC;;;;;;;;;;;ACnUD,qCAAqC;AACrC,4CAAkC;AAClC,yDAAgF;AAChF,4CAKmB;AACnB,6CAAyC;AACzC,+CAAkD;AAClD,4CAAiC;AAMjC,MAAM,KAAK,GAAG,QAAQ,CAAC,aAAa,CAAC,CAAC;AAEtC,MAAM,uBAAuB,GAAG,CAAC,YAAY,EAAE,MAAM,EAAE,UAAU,CAAC,CAAC;AAEnE,SAAgB,WAAW,CAAC,QAAgB;IAC1C,MAAM,aAAa,GAAG,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC1C,OAAO,aAAa,CAAC,aAAa,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,WAAW,EAAE,CAAC;AAC/D,CAAC;AAHD,kCAGC;AAED,SAAS,gBAAgB,CAAC,WAAmB,EAAE,QAAgB;IAC7D,MAAM,QAAQ,GAAG,WAAW,CAAC,QAAQ,CAAC,CAAC;IACvC,QAAQ,QAAQ,EAAE;QAChB,KAAK,MAAM,CAAC;QACZ,KAAK,KAAK,CAAC;QACX,KAAK,MAAM;YACT,IAAI;gBACF,OAAO,sCAAe,CAAC,WAAW,CAAC,CAAC;aACrC;YAAC,OAAO,CAAC,EAAE;gBACV,IAAI,QAAQ,KAAK,MAAM,EAAE;oBACvB,KAAK,CAAC,sCAAsC,CAAC,CAAC;iBAC/C;qBAAM;oBACL,KAAK,CAAC,sCAAsC,CAAC,CAAC;iBAC/C;aACF;YACD,MAAM;QACR;YACE,KAAK,CAAC,qCAAqC,QAAQ,GAAG,CAAC,CAAC;KAC3D;IACD,OAAO,SAAS,CAAC;AACnB,CAAC;AAED,uFAAuF;AACvF,uEAAuE;AACvE,8EAA8E;AAC9E,SAAgB,eAAe,CAC7B,WAAmB,EACnB,QAAgB,EAChB,QAAgB;IAEhB,MAAM,UAAU,GAAU,gBAAgB,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;IAClE,IAAI,CAAC,UAAU,EAAE;QACf,OAAO,EAAE,WAAW,EAAE,KAAK,EAAE,MAAM,EAAE,+BAAsB,CAAC,QAAQ,CAAC,EAAE,CAAC;KACzE;IAED,IAAI,qBAAqB,GAAG,CAAC,CAAC;IAC9B,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,UAAU,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QAC1C,MAAM,SAAS,GAAG,UAAU,CAAC,CAAC,CAAC,CAAC;QAChC,IAAI,CAAC,SAAS,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE;YACjC,SAAS;SACV;QAED,qBAAqB,EAAE,CAAC;QAExB,KAAK,MAAM,GAAG,IAAI,uBAAuB,EAAE;YACzC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,EAAE;gBACnB,KAAK,CAAC,2BAA2B,GAAG,GAAG,CAAC,CAAC;gBACzC,OAAO;oBACL,WAAW,EAAE,KAAK;oBAClB,MAAM,EAAE,+BAAsB,CAAC,QAAQ,CAAC;iBACzC,CAAC;aACH;SACF;KACF;IAED,IAAI,qBAAqB,KAAK,CAAC,EAAE;QAC/B,OAAO;YACL,WAAW,EAAE,KAAK;YAClB,MAAM,EAAE,oCAA2B,CAAC,QAAQ,CAAC;SAC9C,CAAC;KACH;IAED,KAAK,CAAC,qBAAqB,QAAQ,GAAG,CAAC,CAAC;IACxC,OAAO,EAAE,WAAW,EAAE,IAAI,EAAE,MAAM,EAAE,EAAE,EAAE,CAAC;AAC3C,CAAC;AAvCD,0CAuCC;AAEM,KAAK,UAAU,4BAA4B,CAChD,oBAA4B;;IAE5B,MAAM,QAAQ,GAAG,MAAM,qBAAW,CAAC;QACjC,IAAI,EAAE;YACJ,aAAa,EAAE,MAAM,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC;SACpE;QACD,GAAG,EAAE,GAAG,gBAAM,CAAC,GAAG,yBAAyB;QAC3C,MAAM,EAAE,MAAM;QACd,IAAI,EAAE,IAAI;QACV,OAAO,EAAE;YACP,aAAa,EAAE,SAAS,eAAW,EAAE,EAAE;SACxC;KACF,CAAC,CAAC;IAEH,mEAAmE;IACnE,IAAI,QAAQ,CAAC,GAAG,CAAC,UAAU,KAAK,GAAG,EAAE;QACnC,MAAM,IAAI,6BAAoB,EAAE,CAAC;KAClC;IAED,IACE,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU;QACxB,CAAC,QAAQ,CAAC,GAAG,CAAC,UAAU,GAAG,GAAG,IAAI,QAAQ,CAAC,GAAG,CAAC,UAAU,IAAI,GAAG,CAAC,EACjE;QACA,KAAK,CAAC,2BAA2B,QAAQ,CAAC,IAAI,EAAE,CAAC,CAAC;QAClD,MAAM,IAAI,4BAAmB,CAAC,0CAA0C,CAAC,CAAC;KAC3E;IAED,MAAM,EAAE,IAAI,EAAE,GAAG,QAAwC,CAAC;IAC1D,OAAO;QACL,WAAW,QAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,oBAAoB,mCAAI,KAAK;QAChD,MAAM,QAAE,IAAI,aAAJ,IAAI,uBAAJ,IAAI,CAAE,MAAM,mCAAI,EAAE;KAC3B,CAAC;AACJ,CAAC;AAjCD,oEAiCC;;;;;;;;;;;AC7HD,sCAAyB;AACzB,0CAA+B;AAE/B;;;;GAIG;AACH,QAAe,CAAC,CAAC,qBAAqB,CACpC,IAAY,EACZ,UAA4D,EAAE;IAE9D,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;QACtB,MAAM,IAAI,KAAK,CAAC,SAAS,IAAI,sBAAsB,CAAC,CAAC;KACtD;IAED,8DAA8D;IAC9D,QAAQ,CAAC,CAAC,IAAI,CAAC,OAAe,EAAE,YAAoB;QAClD,MAAM,SAAS,GAAG,EAAE,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC;QAC1C,KAAK,MAAM,QAAQ,IAAI,SAAS,EAAE;YAChC,iEAAiE;YACjE,yEAAyE;YACzE,kBAAkB;YAClB,IAAI,CAAC,OAAO,CAAC,eAAe,IAAI,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;gBACxD,SAAS;aACV;YAED,MAAM,QAAQ,GAAG,cAAO,CAAC,OAAO,EAAE,QAAQ,CAAC,CAAC;YAC5C,IAAI,WAAW,CAAC,QAAQ,CAAC,EAAE;gBACzB,qDAAqD;gBACrD,IAAI,OAAO,CAAC,QAAQ,KAAK,YAAY,EAAE;oBACrC,SAAS;iBACV;gBAED,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,YAAY,GAAG,CAAC,CAAC,CAAC;aACzC;iBAAM;gBACL,MAAM,QAAQ,CAAC;aAChB;SACF;IACH,CAAC;IAED,KAAK,CAAC,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC,CAAC;AACvB,CAAC;AAlCD,sDAkCC;AAED,uEAAuE;AACvE,gEAAgE;AAChE,SAAS,WAAW,CAAC,IAAY;IAC/B,IAAI;QACF,sDAAsD;QACtD,OAAO,EAAE,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,WAAW,EAAE,CAAC;KACxC;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,KAAK,CAAC;KACd;AACH,CAAC;;;;;;;;;;;ACrDD,iDAA6C;AAC7C,+CAAqC;AAGrC,sCAAkC;AAGlC,6CAA0C;AAE1C,MAAM,KAAK,GAAG,WAAW,CAAC,MAAM,CAAC,CAAC;AAE3B,KAAK,UAAU,iBAAiB,CACrC,IAAY,EACZ,QAAqD,EACrD,OAAsB,EACtB,GAAqB,EACrB,oBAA6B;IAE7B,MAAM,QAAQ,GAAG,QAAQ,KAAK,QAAQ,CAAC;IACvC,MAAM,aAAa,GAAG,CAAC,KAAK,EAAE,MAAM,CAAC,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;IACzD,UAAU;IACV,IAAI,eAAe,GAAa;QAC9B,OAAO,CAAC,aAAa,CAAC,IAAI,oBAAoB,IAAI,IAAI;KACvD,CAAC;IACF,IAAI,QAAQ,EAAE;QACZ,eAAe,GAAG,eAAe,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,GAAG,KAAK,IAAI,CAAC,CAAC;KACjE;SAAM,IAAI,aAAa,EAAE;QACxB,uDAAuD;QACvD,0CAA0C;QAC1C,eAAe,GAAG,eAAe,CAAC,MAAM,CAAC,gBAAa,CAAC,GAAkB,CAAC,CAAC,CAAC;KAC7E;IAED,KAAK,CAAC,mCAAmC,EAAE,eAAe,CAAC,CAAC;IAC5D,SAAS,CAAC,GAAG,CAAC,UAAU,EAAE,eAAe,CAAC,MAAM,CAAC,CAAC;IAClD,SAAS,CAAC,GAAG,CAAC,iBAAiB,EAAE,eAAe,CAAC,CAAC;IAElD,IAAI,eAAe,CAAC,MAAM,KAAK,CAAC,EAAE;QAChC,OAAO;KACR;IACD,IAAI,MAAM,CAAC;IACX,IAAI;QACF,MAAM,GAAG,MAAM,aAAa,CAAC,IAAI,CAAC,eAAe,EAAE,OAAO,CAAC,CAAC;KAC7D;IAAC,OAAO,GAAG,EAAE;QACZ,iDAAiD;QACjD,6CAA6C;QAC7C,IAAI,GAAG,CAAC,IAAI,KAAK,QAAQ,IAAI,GAAG,CAAC,IAAI,KAAK,SAAS,EAAE;YACnD,MAAM,GAAG,CAAC;SACX;KACF;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AAvCD,8CAuCC;;;;;;;;;;AClDD,kDAAiD;AAAxC,6HAAa;AACtB,uDAA2D;AAAlD,2IAAiB;;;;;;;;;;;ACD1B,MAAM,OAAO,GAAG,mBAAO,CAAC,IAAgB,CAAC,CAAC;AAG1C,SAAgB,aAAa,CAAC,GAAoB;IAChD,IAAI,CAAC,GAAG,EAAE;QACR,OAAO,EAAE,CAAC;KACX;IAED,IAAI,GAAG,CAAC,IAAI,EAAE;QACZ,OAAO,GAAG,CAAC,IAAI,CAAC;KACjB;IAED,IAAI,CAAC,GAAG,CAAC,YAAY,EAAE;QACrB,OAAO,EAAE,CAAC;KACX;IAED,OAAO,OAAO,CACZ,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC;SAC1B,GAAG,CAAC,CAAC,IAAY,EAAE,EAAE,CAAC,aAAa,CAAC,GAAG,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC,CAAC;SAC5D,MAAM,CAAC,OAAO,CAAC,CACnB,CAAC;AACJ,CAAC;AAlBD,sCAkBC","sources":["webpack://snyk/./node_modules/env-paths/index.js","webpack://snyk/./src/cli/commands/drift.ts","webpack://snyk/./src/cli/commands/process-command-args.ts","webpack://snyk/./src/lib/iac/constants.ts","webpack://snyk/./src/lib/iac/drift.ts","webpack://snyk/./src/lib/iac/iac-parser.ts","webpack://snyk/./src/lib/iac/makeDirectoryIterator.ts","webpack://snyk/./src/lib/policy/find-and-load-policy.ts","webpack://snyk/./src/lib/policy/index.ts","webpack://snyk/./src/lib/policy/pluck-policies.ts"],"sourcesContent":["'use strict';\nconst path = require('path');\nconst os = require('os');\n\nconst homedir = os.homedir();\nconst tmpdir = os.tmpdir();\nconst {env} = process;\n\nconst macos = name => {\n\tconst library = path.join(homedir, 'Library');\n\n\treturn {\n\t\tdata: path.join(library, 'Application Support', name),\n\t\tconfig: path.join(library, 'Preferences', name),\n\t\tcache: path.join(library, 'Caches', name),\n\t\tlog: path.join(library, 'Logs', name),\n\t\ttemp: path.join(tmpdir, name)\n\t};\n};\n\nconst windows = name => {\n\tconst appData = env.APPDATA || path.join(homedir, 'AppData', 'Roaming');\n\tconst localAppData = env.LOCALAPPDATA || path.join(homedir, 'AppData', 'Local');\n\n\treturn {\n\t\t// Data/config/cache/log are invented by me as Windows isn't opinionated about this\n\t\tdata: path.join(localAppData, name, 'Data'),\n\t\tconfig: path.join(appData, name, 'Config'),\n\t\tcache: path.join(localAppData, name, 'Cache'),\n\t\tlog: path.join(localAppData, name, 'Log'),\n\t\ttemp: path.join(tmpdir, name)\n\t};\n};\n\n// https://specifications.freedesktop.org/basedir-spec/basedir-spec-latest.html\nconst linux = name => {\n\tconst username = path.basename(homedir);\n\n\treturn {\n\t\tdata: path.join(env.XDG_DATA_HOME || path.join(homedir, '.local', 'share'), name),\n\t\tconfig: path.join(env.XDG_CONFIG_HOME || path.join(homedir, '.config'), name),\n\t\tcache: path.join(env.XDG_CACHE_HOME || path.join(homedir, '.cache'), name),\n\t\t// https://wiki.debian.org/XDGBaseDirectorySpecification#state\n\t\tlog: path.join(env.XDG_STATE_HOME || path.join(homedir, '.local', 'state'), name),\n\t\ttemp: path.join(tmpdir, username, name)\n\t};\n};\n\nconst envPaths = (name, options) => {\n\tif (typeof name !== 'string') {\n\t\tthrow new TypeError(`Expected string, got ${typeof name}`);\n\t}\n\n\toptions = Object.assign({suffix: 'nodejs'}, options);\n\n\tif (options.suffix) {\n\t\t// Add suffix to prevent possible conflict with native apps\n\t\tname += `-${options.suffix}`;\n\t}\n\n\tif (process.platform === 'darwin') {\n\t\treturn macos(name);\n\t}\n\n\tif (process.platform === 'win32') {\n\t\treturn windows(name);\n\t}\n\n\treturn linux(name);\n};\n\nmodule.exports = envPaths;\n// TODO: Remove this for the next major release\nmodule.exports.default = envPaths;\n","import { MethodArgs } from '../args';\nimport { processCommandArgs } from './process-command-args';\nimport { driftctl, parseArgs } from '../../lib/iac/drift';\nimport { UnsupportedEntitlementCommandError } from './test/iac-local-execution/assert-iac-options-flag';\nimport { getIacOrgSettings } from './test/iac-local-execution/measurable-methods';\nimport config from '../../lib/config';\n\nconst legacyError = require('../../lib/errors/legacy-errors');\n\nexport default async function drift(...args: MethodArgs): Promise<any> {\n  const { options, paths } = processCommandArgs(...args);\n\n  if (options.iac != true) {\n    return legacyError('drift');\n  }\n\n  const orgPublicId = options.org ?? config.org;\n  const iacOrgSettings = await getIacOrgSettings(orgPublicId);\n\n  if (!iacOrgSettings.entitlements?.iacDrift) {\n    throw new UnsupportedEntitlementCommandError('drift', 'iacDrift');\n  }\n\n  try {\n    const args = parseArgs(paths, options);\n    const ret = await driftctl(args);\n    process.exit(ret);\n  } catch (e) {\n    const err = new Error('Error running `iac drift` ' + e);\n    return Promise.reject(err);\n  }\n}\n","import { Options } from '../../lib/types';\n\nexport function processCommandArgs<CommandOptions>(\n  ...args\n): { paths: string[]; options: Options & CommandOptions } {\n  let options = ({} as any) as Options & CommandOptions;\n\n  if (typeof args[args.length - 1] === 'object') {\n    options = (args.pop() as any) as Options & CommandOptions;\n  }\n  args = args.filter(Boolean);\n\n  // For repository scanning, populate with default path (cwd) if no path given\n  if (args.length === 0 && !options.docker) {\n    args.unshift(process.cwd());\n  }\n\n  return { options, paths: args };\n}\n","import { ParserFileType } from '@snyk/cloud-config-parser';\n\nexport type IacProjectTypes =\n  | 'k8sconfig'\n  | 'terraformconfig'\n  | 'cloudformationconfig'\n  | 'armconfig'\n  | 'customconfig'\n  | 'multiiacconfig';\nexport type IacFileTypes = ParserFileType | 'tf';\n\nexport enum IacProjectType {\n  K8S = 'k8sconfig',\n  TERRAFORM = 'terraformconfig',\n  CLOUDFORMATION = 'cloudformationconfig',\n  ARM = 'armconfig',\n  CUSTOM = 'customconfig',\n  MULTI_IAC = 'multiiacconfig',\n}\n\nexport const TEST_SUPPORTED_IAC_PROJECTS: IacProjectTypes[] = [\n  IacProjectType.K8S,\n  IacProjectType.TERRAFORM,\n  IacProjectType.CLOUDFORMATION,\n  IacProjectType.ARM,\n  IacProjectType.MULTI_IAC,\n  IacProjectType.CUSTOM,\n];\n\nexport const projectTypeByFileType = {\n  yaml: IacProjectType.K8S,\n  yml: IacProjectType.K8S,\n  json: IacProjectType.K8S,\n  tf: IacProjectType.TERRAFORM,\n};\n\nexport type IacValidateTerraformResponse = {\n  body?: {\n    isValidTerraformFile: boolean;\n    reason: string;\n  };\n};\n\nexport interface IacValidationResponse {\n  isValidFile: boolean;\n  reason: string;\n}\n","import * as debugLib from 'debug';\nimport * as child_process from 'child_process';\nimport * as os from 'os';\nimport envPaths from 'env-paths';\nimport * as fs from 'fs';\nimport { spinner } from '../spinner';\nimport { makeRequest } from '../request';\nimport config from '../../lib/config';\nimport * as path from 'path';\nimport * as crypto from 'crypto';\n\nconst cachePath = config.CACHE_PATH ?? envPaths('snyk').cache;\nconst debug = debugLib('drift');\n\nexport const driftctlVersion = 'v0.19.0';\nconst driftctlChecksums = {\n  'driftctl_windows_386.exe':\n    '0336132cc0c24beaef2535e0a129d146c1a267f6296d5d6bcc7fbe0b02f0bc78',\n  driftctl_darwin_amd64:\n    '07eae8f9e537183031bb78203c1c50a0ca80e114716598946b76baadcbca2656',\n  driftctl_linux_386:\n    '4b83a5644ce72d3eabd915ffc1bba13ad1d61914984801800f598b35db2fe054',\n  driftctl_linux_amd64:\n    '4bfd536e2123667e01b6e5d54acc27733be0db5a00b7fda7f41fabcd9e910e1d',\n  driftctl_linux_arm64:\n    '50bbf8f47ec7dcb9cc09a628444b093a0305aa9b4accc84b7c366a2297390881',\n  'driftctl_windows_arm64.exe':\n    '6eee390fb97998f309ff0491b893d8727f90f45b98f42fd1aa3ebef29fd7fc5b',\n  driftctl_darwin_arm64:\n    '6f37d9f2e385ef81adea9a1f68f2c85f859608dd854416d8ecf629e626bc8b0c',\n  'driftctl_windows_arm.exe':\n    '7ce916deaad289f41c874a4ddff41e9e6195cd5f78821a5769f8e66434be5465',\n  driftctl_linux_arm:\n    'a73193472fb33744f0a344a5f3a5663bd0f4791c393a68ea1b4c219b02eda8f1',\n  'driftctl_windows_amd64.exe':\n    'be423648c164f816ea98eae9694aa7c6679d0a6c33305aceb435cd75821bc730',\n};\n\nconst dctlBaseUrl = 'https://github.com/snyk/driftctl/releases/download/';\nconst driftctlPath = path.join(cachePath, 'driftctl_' + driftctlVersion);\n\ninterface DriftCTLOptions {\n  quiet?: true;\n  filter?: string;\n  output?: string;\n  to?: string;\n  headers?: string;\n  'tfc-token'?: string;\n  'tfc-endpoint'?: string;\n  'tf-provider-version'?: string;\n  strict?: true;\n  deep?: true;\n  driftignore?: string;\n  'tf-lockfile'?: string;\n  'config-dir'?: string;\n  from?: string; // TODO We only handle one from at a time due to snyk cli arg parsing\n}\n\nexport function parseArgs(\n  commands: string[],\n  options: DriftCTLOptions,\n): string[] {\n  const args: string[] = commands;\n\n  if (options.quiet) {\n    args.push('--quiet');\n  }\n\n  if (options.filter) {\n    args.push('--filter');\n    args.push(options.filter);\n  }\n\n  if (options.output) {\n    args.push('--output');\n    args.push(options.output);\n  }\n\n  if (options.headers) {\n    args.push('--headers');\n    args.push(options.headers);\n  }\n\n  if (options['tfc-token']) {\n    args.push('--tfc-token');\n    args.push(options['tfc-token']);\n  }\n\n  if (options['tfc-endpoint']) {\n    args.push('--tfc-endpoint');\n    args.push(options['tfc-endpoint']);\n  }\n\n  if (options['tf-provider-version']) {\n    args.push('--tf-provider-version');\n    args.push(options['tf-provider-version']);\n  }\n\n  if (options.strict) {\n    args.push('--strict');\n  }\n\n  if (options.deep) {\n    args.push('--deep');\n  }\n\n  if (options.driftignore) {\n    args.push('--driftignore');\n    args.push(options.driftignore);\n  }\n\n  if (options['tf-lockfile']) {\n    args.push('--tf-lockfile');\n    args.push(options['tf-lockfile']);\n  }\n\n  let configDir = cachePath;\n  createIfNotExists(cachePath);\n  if (options['config-dir']) {\n    configDir = options['config-dir'];\n  }\n  args.push('--config-dir');\n  args.push(configDir);\n\n  if (options.from) {\n    args.push('--from');\n    args.push(options.from);\n  }\n\n  let to = 'aws+tf';\n  if (options.to) {\n    to = options.to;\n  }\n  args.push('--to');\n  args.push(to);\n\n  debug(args);\n\n  return args;\n}\n\nexport async function driftctl(args: string[]): Promise<number> {\n  debug('running driftctl %s ', args.join(' '));\n\n  const path = await findOrDownload();\n\n  return await launch(path, args);\n}\n\nasync function launch(path: string, args: string[]): Promise<number> {\n  return new Promise<number>((resolve, reject) => {\n    const child = child_process.spawn(path, args, { stdio: 'inherit' });\n\n    child.on('error', (error) => {\n      reject(error);\n    });\n\n    child.on('exit', (code) => {\n      if (code == null) {\n        //failed to find why this could happen...\n        reject(new Error('Process was terminated'));\n      } else {\n        resolve(code);\n      }\n    });\n  });\n}\n\nasync function findOrDownload(): Promise<string> {\n  let dctl = await findDriftCtl();\n  if (dctl === '') {\n    try {\n      createIfNotExists(cachePath);\n      dctl = driftctlPath;\n      await download(driftctlUrl(), dctl);\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  }\n  return dctl;\n}\n\nexport async function findDriftCtl(): Promise<string> {\n  // lookup in custom path contained in env var DRIFTCTL_PATH\n  let dctlPath = config.DRIFTCTL_PATH;\n  if (dctlPath != null) {\n    const exists = await isExe(dctlPath);\n    if (exists) {\n      debug('Found driftctl in $DRIFTCTL_PATH: %s', dctlPath);\n      return dctlPath;\n    }\n  }\n\n  // lookup in app cache\n  dctlPath = driftctlPath;\n  const exists = await isExe(dctlPath);\n  if (exists) {\n    debug('Found driftctl in cache: %s', dctlPath);\n    return dctlPath;\n  }\n  debug('driftctl not found');\n\n  return '';\n}\n\nasync function download(url, destination: string): Promise<boolean> {\n  debug('downloading driftctl into %s', destination);\n\n  const payload = {\n    method: 'GET',\n    url: url,\n    output: destination,\n    follow: 3,\n  };\n\n  await spinner('Downloading...');\n  return new Promise<boolean>((resolve, reject) => {\n    makeRequest(payload, function(err, res, body) {\n      try {\n        if (err) {\n          reject(\n            new Error('Could not download driftctl from ' + url + ': ' + err),\n          );\n          return;\n        }\n        if (res.statusCode !== 200) {\n          reject(\n            new Error(\n              'Could not download driftctl from ' + url + ': ' + res.statusCode,\n            ),\n          );\n          return;\n        }\n\n        validateChecksum(body);\n\n        fs.writeFileSync(destination, body);\n        debug('File saved: ' + destination);\n\n        fs.chmodSync(destination, 0o744);\n        resolve(true);\n      } finally {\n        spinner.clearAll();\n      }\n    });\n  });\n}\n\nfunction validateChecksum(body: string) {\n  // only validate if we downloaded the official driftctl binary\n  if (config.DRIFTCTL_URL || config.DRIFTCTL_PATH) {\n    return;\n  }\n\n  const computedHash = crypto\n    .createHash('sha256')\n    .update(body)\n    .digest('hex');\n  const givenHash = driftctlChecksums[driftctlFileName()];\n\n  if (computedHash != givenHash) {\n    throw new Error('Downloaded file has inconsistent checksum...');\n  }\n}\nfunction driftctlFileName(): string {\n  let platform = 'linux';\n  switch (os.platform()) {\n    case 'darwin':\n      platform = 'darwin';\n      break;\n    case 'win32':\n      platform = 'windows';\n      break;\n  }\n\n  let arch = 'amd64';\n  switch (os.arch()) {\n    case 'ia32':\n    case 'x32':\n      arch = '386';\n      break;\n    case 'arm':\n      arch = 'arm';\n      break;\n    case 'arm64':\n      arch = 'arm64';\n      break;\n  }\n\n  let ext = '';\n  switch (os.platform()) {\n    case 'win32':\n      ext = '.exe';\n      break;\n  }\n\n  return `driftctl_${platform}_${arch}${ext}`;\n}\n\nfunction driftctlUrl(): string {\n  if (config.DRIFTCTL_URL) {\n    return config.DRIFTCTL_URL;\n  }\n\n  return `${dctlBaseUrl}/${driftctlVersion}/${driftctlFileName()}`;\n}\n\nfunction isExe(dctlPath: string): Promise<boolean> {\n  return new Promise<boolean>((resolve) => {\n    fs.access(dctlPath, fs.constants.X_OK, (err) => {\n      if (err) {\n        resolve(false);\n        return;\n      }\n      resolve(true);\n    });\n  });\n}\n\nfunction createIfNotExists(path: string) {\n  if (!fs.existsSync(path)) {\n    fs.mkdirSync(path, { recursive: true });\n  }\n}\n","//TODO(orka): take out into a new lib\nimport * as debugLib from 'debug';\nimport { parseFileContent as parseYAMLOrJSON } from '@snyk/cloud-config-parser';\nimport {\n  IllegalIacFileErrorMsg,\n  InternalServerError,\n  MissingApiTokenError,\n  NotSupportedIacFileErrorMsg,\n} from '../errors';\nimport { makeRequest } from '../request';\nimport { api as getApiToken } from '../api-token';\nimport config from './../config';\nimport {\n  IacValidateTerraformResponse,\n  IacValidationResponse,\n} from './constants';\n\nconst debug = debugLib('snyk-detect');\n\nconst requiredK8SObjectFields = ['apiVersion', 'kind', 'metadata'];\n\nexport function getFileType(filePath: string): string {\n  const filePathSplit = filePath.split('.');\n  return filePathSplit[filePathSplit.length - 1].toLowerCase();\n}\n\nfunction parseFileContent(fileContent: string, filePath: string): any {\n  const fileType = getFileType(filePath);\n  switch (fileType) {\n    case 'yaml':\n    case 'yml':\n    case 'json':\n      try {\n        return parseYAMLOrJSON(fileContent);\n      } catch (e) {\n        if (fileType === 'json') {\n          debug('Failed to parse iac config as a JSON');\n        } else {\n          debug('Failed to parse iac config as a YAML');\n        }\n      }\n      break;\n    default:\n      debug(`Unsupported iac config file type (${fileType})`);\n  }\n  return undefined;\n}\n\n// This function validates that there is at least one valid doc with a k8s object kind.\n// If there is a doc with a supported kind, but invalid, we should fail\n// The function return true if the yaml is a valid k8s one, or false otherwise\nexport function validateK8sFile(\n  fileContent: string,\n  filePath: string,\n  fileName: string,\n): IacValidationResponse {\n  const k8sObjects: any[] = parseFileContent(fileContent, filePath);\n  if (!k8sObjects) {\n    return { isValidFile: false, reason: IllegalIacFileErrorMsg(fileName) };\n  }\n\n  let numOfSupportedKeyDocs = 0;\n  for (let i = 0; i < k8sObjects.length; i++) {\n    const k8sObject = k8sObjects[i];\n    if (!k8sObject || !k8sObject.kind) {\n      continue;\n    }\n\n    numOfSupportedKeyDocs++;\n\n    for (const key of requiredK8SObjectFields) {\n      if (!k8sObject[key]) {\n        debug(`Missing required field (${key})`);\n        return {\n          isValidFile: false,\n          reason: IllegalIacFileErrorMsg(fileName),\n        };\n      }\n    }\n  }\n\n  if (numOfSupportedKeyDocs === 0) {\n    return {\n      isValidFile: false,\n      reason: NotSupportedIacFileErrorMsg(fileName),\n    };\n  }\n\n  debug(`k8s config found (${filePath})`);\n  return { isValidFile: true, reason: '' };\n}\n\nexport async function makeValidateTerraformRequest(\n  terraformFileContent: string,\n): Promise<IacValidationResponse> {\n  const response = await makeRequest({\n    body: {\n      contentBase64: Buffer.from(terraformFileContent).toString('base64'),\n    },\n    url: `${config.API}/iac-validate/terraform`,\n    method: 'POST',\n    json: true,\n    headers: {\n      Authorization: `token ${getApiToken()}`,\n    },\n  });\n\n  // Token may have expired, so we need to ask the client to re-auth.\n  if (response.res.statusCode === 401) {\n    throw new MissingApiTokenError();\n  }\n\n  if (\n    !response.res.statusCode ||\n    (response.res.statusCode < 200 && response.res.statusCode >= 300)\n  ) {\n    debug(`internal server error - ${response.body}`);\n    throw new InternalServerError('Error occurred validating terraform file');\n  }\n\n  const { body } = response as IacValidateTerraformResponse;\n  return {\n    isValidFile: body?.isValidTerraformFile ?? false,\n    reason: body?.reason ?? '',\n  };\n}\n","import * as fs from 'fs';\nimport { resolve } from 'path';\n\n/**\n * Walk the provided directory tree, depth first, yielding the matched filename\n * to the caller. An optional `maxDepth` argument can be provided to limit how\n * deep in the file tree the search will go.\n */\nexport function* makeDirectoryIterator(\n  root: string,\n  options: { maxDepth?: number; includeDotfiles?: boolean } = {},\n) {\n  if (!isDirectory(root)) {\n    throw new Error(`Path \"${root}\" is not a directory`);\n  }\n\n  // Internal function to allow us to track the recursion depth.\n  function* walk(dirpath: string, currentDepth: number) {\n    const filenames = fs.readdirSync(dirpath);\n    for (const filename of filenames) {\n      // NOTE: We filter filenames that start with a period to maintain\n      // backwards compatibility with the original implementation that used the\n      // \"glob\" package.\n      if (!options.includeDotfiles && filename.startsWith('.')) {\n        continue;\n      }\n\n      const resolved = resolve(dirpath, filename);\n      if (isDirectory(resolved)) {\n        // Skip this directory if max depth has been reached.\n        if (options.maxDepth === currentDepth) {\n          continue;\n        }\n\n        yield* walk(resolved, currentDepth + 1);\n      } else {\n        yield resolved;\n      }\n    }\n  }\n\n  yield* walk(root, 1);\n}\n\n// NOTE: We use isDirectory here instead of isLocalFolder() in order to\n// follow symlinks and match the original glob() implementation.\nfunction isDirectory(path: string): boolean {\n  try {\n    // statSync will resolve symlinks, lstatSync will not.\n    return fs.statSync(path).isDirectory();\n  } catch (e) {\n    return false;\n  }\n}\n","import * as snykPolicyLib from 'snyk-policy';\nimport * as debugModule from 'debug';\nimport { PackageExpanded } from 'snyk-resolve-deps';\n\nimport { pluckPolicies } from '.';\nimport { SupportedPackageManagers } from '../package-managers';\nimport { PackageJson, PolicyOptions } from '../types';\nimport * as analytics from '../analytics';\n\nconst debug = debugModule('snyk');\n\nexport async function findAndLoadPolicy(\n  root: string,\n  scanType: SupportedPackageManagers | 'docker' | 'iac',\n  options: PolicyOptions,\n  pkg?: PackageExpanded,\n  scannedProjectFolder?: string,\n): Promise<Policy | undefined> {\n  const isDocker = scanType === 'docker';\n  const isNodeProject = ['npm', 'yarn'].includes(scanType);\n  // monitor\n  let policyLocations: string[] = [\n    options['policy-path'] || scannedProjectFolder || root,\n  ];\n  if (isDocker) {\n    policyLocations = policyLocations.filter((loc) => loc !== root);\n  } else if (isNodeProject) {\n    // TODO: pluckPolicies expects a package.json object to\n    // find and apply policies in node_modules\n    policyLocations = policyLocations.concat(pluckPolicies(pkg as PackageJson));\n  }\n\n  debug('Potential policy locations found:', policyLocations);\n  analytics.add('policies', policyLocations.length);\n  analytics.add('policyLocations', policyLocations);\n\n  if (policyLocations.length === 0) {\n    return;\n  }\n  let policy;\n  try {\n    policy = await snykPolicyLib.load(policyLocations, options);\n  } catch (err) {\n    // note: inline catch, to handle error from .load\n    // if the .snyk file wasn't found, it is fine\n    if (err.code !== 'ENOENT' && err.code !== 'ENOTDIR') {\n      throw err;\n    }\n  }\n  return policy;\n}\n\nexport interface Policy {\n  filter(vulns: any, root?: string, matchStrategy?: string): any;\n}\n","export { pluckPolicies } from './pluck-policies';\nexport { findAndLoadPolicy } from './find-and-load-policy';\n","const flatten = require('lodash.flatten');\nimport { PackageExpanded } from 'snyk-resolve-deps';\n\nexport function pluckPolicies(pkg: PackageExpanded): string[] | string {\n  if (!pkg) {\n    return [];\n  }\n\n  if (pkg.snyk) {\n    return pkg.snyk;\n  }\n\n  if (!pkg.dependencies) {\n    return [];\n  }\n\n  return flatten(\n    Object.keys(pkg.dependencies)\n      .map((name: string) => pluckPolicies(pkg.dependencies[name]))\n      .filter(Boolean),\n  );\n}\n"],"names":[],"sourceRoot":""}